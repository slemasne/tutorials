<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>SVP100 - Hitting The Wall | Stephen Lemasney</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="SVP100 - Hitting The Wall" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="SVP100 - Hitting The Wall" />
<meta property="og:description" content="SVP100 - Hitting The Wall" />
<link rel="canonical" href="https://slemasne.github.io/tutorials/tutorials/markdown/2018/03/02/svp.html" />
<meta property="og:url" content="https://slemasne.github.io/tutorials/tutorials/markdown/2018/03/02/svp.html" />
<meta property="og:site_name" content="Stephen Lemasney" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-03-02T00:00:00-06:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="SVP100 - Hitting The Wall" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2018-03-02T00:00:00-06:00","datePublished":"2018-03-02T00:00:00-06:00","description":"SVP100 - Hitting The Wall","headline":"SVP100 - Hitting The Wall","mainEntityOfPage":{"@type":"WebPage","@id":"https://slemasne.github.io/tutorials/tutorials/markdown/2018/03/02/svp.html"},"url":"https://slemasne.github.io/tutorials/tutorials/markdown/2018/03/02/svp.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/tutorials/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://slemasne.github.io/tutorials/tutorials/feed.xml" title="Stephen Lemasney" /><!-- the google_analytics_id gets auto inserted from the config file -->



<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-57531313-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-57531313-5');
</script>


<link rel="shortcut icon" type="image/x-icon" href="/tutorials/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />

<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/tutorials/">Stephen Lemasney</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/tutorials/about/">About Me</a><a class="page-link" href="/tutorials/">Tutorials</a><a class="page-link" href="/tutorials/search/">Search</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">SVP100 - Hitting The Wall</h1><p class="page-description">SVP100 - Hitting The Wall</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2018-03-02T00:00:00-06:00" itemprop="datePublished">
        Mar 2, 2018
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      7 min read
    
</span></p>

    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul id="toc" class="section-nav">
<li class="toc-entry toc-h1"><a href="#svp100---hitting-the-wall">SVP100 - Hitting The Wall</a>
<ul>
<li class="toc-entry toc-h2"><a href="#1-import-packages-and-set-configurations">1. Import packages and set configurations</a></li>
<li class="toc-entry toc-h2"><a href="#2-generate-unformatted-table-of-race-data">2. Generate unformatted table of race data</a></li>
<li class="toc-entry toc-h2"><a href="#3-clean-the-table-of-race-data">3. Clean the table of race data</a></li>
<li class="toc-entry toc-h2"><a href="#create-class-for-scraping-and-organising-data">Create class for scraping and organising data</a></li>
<li class="toc-entry toc-h2"><a href="#define-some-variables-we-will-pass-to-our-class">Define some variables we will pass to our class</a></li>
<li class="toc-entry toc-h2"><a href="#initialize-a-results-object-with-results-from-2017-race">Initialize a Results() object with results from 2017 race¶</a></li>
<li class="toc-entry toc-h2"><a href="#plot-the-results-using-fivethirtyeight-styling">Plot the results using “FiveThirtyEight” styling</a></li>
</ul>
</li>
</ul><h1 id="svp100---hitting-the-wall">
<a class="anchor" href="#svp100---hitting-the-wall" aria-hidden="true"><span class="octicon octicon-link"></span></a>SVP100 - Hitting The Wall</h1>

<p>In August of 2017 I ran the SVP100. This is a 100KM trail running race starting in Newmarket (Suffolk, UK) and ending in Manning Tree (Essex, UK). In regular distance marathons, its widely believed runners “hit the wall” at around 30KM mark (or 70% through the race). In this notebook, I want to see if the same holds true over a 100KM distance.</p>

<p>From a high level, the code below performs the following:</p>

<ol>
  <li>
    <p>Scrape results data from the race website (using Beautiful Soup)</p>
  </li>
  <li>
    <p>Render scraped data into a DataFrame (using Pandas)</p>
  </li>
  <li>
    <p>Format (or wrangle) the data into formats we can work with</p>
  </li>
  <li>
    <p>Present results in time series graph (using Seaborn)</p>
  </li>
</ol>

<h2 id="1-import-packages-and-set-configurations">
<a class="anchor" href="#1-import-packages-and-set-configurations" aria-hidden="true"><span class="octicon octicon-link"></span></a>1. Import packages and set configurations</h2>

<p>First, let’s import some packages. We’ll use BeautifulSoup for web scraping, pandas for data analysis, and then seaborn for plotting.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Import the packages we'll use for our analysis
</span><span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>

<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="n">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
</code></pre></div></div>

<p>Then we set the plotting configuration. I really like the “fivethirtyeight” stylesheet which generates plots in the style used by fivethirtyeight.com.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Use line magic function to enable matplotlib to work interactively with iPython
</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="o">%</span><span class="n">pylab</span> <span class="n">inline</span>

<span class="c1"># Set style to fivethirtyeight to create clean and clear looking graphs
</span>
<span class="n">plt</span><span class="p">.</span><span class="n">style</span><span class="p">.</span><span class="n">use</span><span class="p">(</span><span class="s">'fivethirtyeight'</span><span class="p">)</span>

<span class="c1"># Define a dictionary containing default plotting configurations
</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s">'legend.fontsize'</span><span class="p">:</span> <span class="s">'small'</span><span class="p">,</span>
          <span class="s">'figure.figsize'</span><span class="p">:</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">),</span>
         <span class="s">'axes.labelsize'</span><span class="p">:</span> <span class="s">'small'</span><span class="p">,</span>
         <span class="s">'axes.titlesize'</span><span class="p">:</span><span class="s">'medium'</span><span class="p">,</span>
         <span class="s">'xtick.labelsize'</span><span class="p">:</span><span class="s">'small'</span><span class="p">,</span>
         <span class="s">'ytick.labelsize'</span><span class="p">:</span><span class="s">'small'</span><span class="p">}</span>

<span class="n">pylab</span><span class="p">.</span><span class="n">rcParams</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Populating the interactive namespace from numpy and matplotlib
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">BASE_URL</span> <span class="o">=</span> <span class="s">"http://www.svp100.co.uk/results-"</span>
<span class="n">YEAR</span> <span class="o">=</span> <span class="mi">2017</span>
</code></pre></div></div>

<h2 id="2-generate-unformatted-table-of-race-data">
<a class="anchor" href="#2-generate-unformatted-table-of-race-data" aria-hidden="true"><span class="octicon octicon-link"></span></a>2. Generate unformatted table of race data</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">df_builder</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="n">BASE_URL</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="n">YEAR</span><span class="p">):</span>
    
    <span class="s">"""
    This function returns a pandas DataFrame which contain data scraped from the race website.
    The data is unformatted.
    
    Attributes:
    -----------
    base_url: the url which contains race data in HTML
    year: the year for we would like data
    """</span>
    
    <span class="c1"># Scrape the data from the race website
</span>    <span class="n">url</span> <span class="o">=</span> <span class="n">base_url</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">).</span><span class="n">text</span>
    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="s">'lxml'</span><span class="p">)</span>
    
    <span class="c1"># Find tables from the html
</span>    <span class="n">rows</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="n">find_all</span><span class="p">(</span><span class="s">'tr'</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
    
    <span class="c1"># Collect and format column names for the dataframe
</span>    <span class="n">column_html</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="n">find_all</span><span class="p">(</span><span class="s">'th'</span><span class="p">)[:]</span>    
    <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">.</span><span class="n">contents</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">lower</span><span class="p">().</span><span class="n">replace</span><span class="p">(</span><span class="s">"/"</span><span class="p">,</span><span class="s">""</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="s">" "</span><span class="p">,</span> <span class="s">"_"</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">column_html</span> <span class="k">if</span> <span class="n">i</span><span class="p">.</span><span class="n">contents</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

    <span class="c1"># Build a dataframe
</span>    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">line</span><span class="p">.</span><span class="n">find_all</span><span class="p">(</span><span class="s">'td'</span><span class="p">)</span>
        <span class="n">row_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">counter</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
            <span class="n">row_list</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">counter</span><span class="p">].</span><span class="n">string</span><span class="p">)</span>
        <span class="n">data</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">row_list</span><span class="p">)</span>
            
    <span class="k">return</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">).</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s">"name"</span><span class="p">,</span> <span class="s">"club"</span><span class="p">]).</span><span class="n">set_index</span><span class="p">(</span><span class="s">"position"</span><span class="p">)</span>

</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">unformatted_df</span> <span class="o">=</span> <span class="n">df_builder</span><span class="p">(</span><span class="n">BASE_URL</span><span class="p">,</span> <span class="n">YEAR</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">unformatted_df</span><span class="p">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>bib</th>
      <th>mf</th>
      <th>start</th>
      <th>cp1</th>
      <th>cp2</th>
      <th>cp3</th>
      <th>cp4</th>
      <th>cp5</th>
      <th>cp6</th>
      <th>finish</th>
      <th>total_time</th>
    </tr>
    <tr>
      <th>position</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>91</th>
      <td>162</td>
      <td>Female</td>
      <td>07:00:00</td>
      <td>09:51:33</td>
      <td>DNF</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>92</th>
      <td>7</td>
      <td>Male</td>
      <td>08:30:00</td>
      <td>10:23:05</td>
      <td>DNF</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
</div>

<h2 id="3-clean-the-table-of-race-data">
<a class="anchor" href="#3-clean-the-table-of-race-data" aria-hidden="true"><span class="octicon octicon-link"></span></a>3. Clean the table of race data</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dt_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s">"start"</span><span class="p">,</span> <span class="s">"cp1"</span><span class="p">,</span> <span class="s">"cp2"</span><span class="p">,</span> <span class="s">"cp3"</span><span class="p">,</span> <span class="s">"cp4"</span><span class="p">,</span> <span class="s">"cp5"</span><span class="p">,</span> <span class="s">"cp6"</span><span class="p">,</span> <span class="s">"finish"</span><span class="p">,</span> <span class="s">"total_time"</span><span class="p">]</span>
<span class="n">unformatted_df</span> <span class="o">=</span> <span class="n">unformatted_df</span><span class="p">.</span><span class="n">dropna</span><span class="p">()</span>

</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dt_cols</span><span class="p">:</span>
    
    <span class="n">unformatted_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">unformatted_df</span><span class="p">[</span><span class="n">col</span><span class="p">].</span><span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="p">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s">"2017-08-08 "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
        
    
    
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">unformatted_df</span><span class="p">[</span><span class="s">"time2cp1"</span><span class="p">]</span> <span class="o">=</span> <span class="n">unformatted_df</span><span class="p">.</span><span class="n">cp1</span> <span class="o">-</span> <span class="n">unformatted_df</span><span class="p">.</span><span class="n">start</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">unformatted_df</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>bib</th>
      <th>mf</th>
      <th>start</th>
      <th>cp1</th>
      <th>cp2</th>
      <th>cp3</th>
      <th>cp4</th>
      <th>cp5</th>
      <th>cp6</th>
      <th>finish</th>
      <th>total_time</th>
      <th>time2cp1</th>
    </tr>
    <tr>
      <th>position</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>19</td>
      <td>Male</td>
      <td>2017-08-08 08:30:00</td>
      <td>2017-08-08 09:58:30</td>
      <td>2017-08-08 11:26:51</td>
      <td>2017-08-08 12:58:00</td>
      <td>2017-08-08 14:34:00</td>
      <td>2017-08-08 15:41:00</td>
      <td>2017-08-08 17:04:49</td>
      <td>2017-08-08 17:54:10</td>
      <td>2017-08-08 09:24:10</td>
      <td>0 days 01:28:30</td>
    </tr>
    <tr>
      <th>2</th>
      <td>20</td>
      <td>Male</td>
      <td>2017-08-08 08:30:00</td>
      <td>2017-08-08 09:56:03</td>
      <td>2017-08-08 11:22:10</td>
      <td>2017-08-08 13:20:00</td>
      <td>2017-08-08 15:14:00</td>
      <td>2017-08-08 16:31:00</td>
      <td>2017-08-08 18:13:51</td>
      <td>2017-08-08 19:09:10</td>
      <td>2017-08-08 10:39:10</td>
      <td>0 days 01:26:03</td>
    </tr>
    <tr>
      <th>3</th>
      <td>13</td>
      <td>Female</td>
      <td>2017-08-08 08:30:00</td>
      <td>2017-08-08 10:14:44</td>
      <td>2017-08-08 12:01:06</td>
      <td>2017-08-08 13:50:00</td>
      <td>2017-08-08 15:42:00</td>
      <td>2017-08-08 16:56:00</td>
      <td>2017-08-08 18:33:49</td>
      <td>2017-08-08 19:30:55</td>
      <td>2017-08-08 11:00:55</td>
      <td>0 days 01:44:44</td>
    </tr>
    <tr>
      <th>4</th>
      <td>8</td>
      <td>Male</td>
      <td>2017-08-08 08:30:00</td>
      <td>2017-08-08 10:15:26</td>
      <td>2017-08-08 12:08:01</td>
      <td>2017-08-08 13:52:00</td>
      <td>2017-08-08 15:52:00</td>
      <td>2017-08-08 17:12:00</td>
      <td>2017-08-08 18:53:46</td>
      <td>2017-08-08 19:53:37</td>
      <td>2017-08-08 11:23:37</td>
      <td>0 days 01:45:26</td>
    </tr>
    <tr>
      <th>5</th>
      <td>143</td>
      <td>Male</td>
      <td>2017-08-08 07:00:00</td>
      <td>2017-08-08 08:49:35</td>
      <td>2017-08-08 10:44:27</td>
      <td>2017-08-08 12:33:00</td>
      <td>2017-08-08 14:41:00</td>
      <td>2017-08-08 16:02:00</td>
      <td>2017-08-08 17:40:23</td>
      <td>2017-08-08 18:36:58</td>
      <td>2017-08-08 11:36:58</td>
      <td>0 days 01:49:35</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>63</th>
      <td>186</td>
      <td>Female</td>
      <td>2017-08-08 07:00:00</td>
      <td>2017-08-08 09:15:33</td>
      <td>2017-08-08 11:53:05</td>
      <td>2017-08-08 14:17:00</td>
      <td>2017-08-08 17:03:00</td>
      <td>2017-08-08 18:56:00</td>
      <td>2017-08-08 21:01:02</td>
      <td>2017-08-08 22:21:22</td>
      <td>2017-08-08 15:21:22</td>
      <td>0 days 02:15:33</td>
    </tr>
    <tr>
      <th>64</th>
      <td>120</td>
      <td>Male</td>
      <td>2017-08-08 07:00:00</td>
      <td>2017-08-08 09:15:41</td>
      <td>2017-08-08 11:53:00</td>
      <td>2017-08-08 14:17:00</td>
      <td>2017-08-08 17:03:00</td>
      <td>2017-08-08 18:56:00</td>
      <td>2017-08-08 21:01:04</td>
      <td>2017-08-08 22:21:22</td>
      <td>2017-08-08 15:21:22</td>
      <td>0 days 02:15:41</td>
    </tr>
    <tr>
      <th>65</th>
      <td>104</td>
      <td>Male</td>
      <td>2017-08-08 07:00:00</td>
      <td>2017-08-08 09:15:30</td>
      <td>2017-08-08 11:53:08</td>
      <td>2017-08-08 14:17:00</td>
      <td>2017-08-08 17:03:00</td>
      <td>2017-08-08 18:56:00</td>
      <td>2017-08-08 21:01:13</td>
      <td>2017-08-08 22:21:22</td>
      <td>2017-08-08 15:21:22</td>
      <td>0 days 02:15:30</td>
    </tr>
    <tr>
      <th>66</th>
      <td>121</td>
      <td>Female</td>
      <td>2017-08-08 07:00:00</td>
      <td>2017-08-08 09:14:56</td>
      <td>2017-08-08 11:41:59</td>
      <td>2017-08-08 14:10:00</td>
      <td>2017-08-08 16:54:00</td>
      <td>2017-08-08 18:41:00</td>
      <td>2017-08-08 21:00:25</td>
      <td>2017-08-08 22:27:51</td>
      <td>2017-08-08 15:27:51</td>
      <td>0 days 02:14:56</td>
    </tr>
    <tr>
      <th>67</th>
      <td>154</td>
      <td>Male</td>
      <td>2017-08-08 07:00:00</td>
      <td>2017-08-08 09:14:43</td>
      <td>2017-08-08 11:42:09</td>
      <td>2017-08-08 14:10:00</td>
      <td>2017-08-08 16:57:00</td>
      <td>2017-08-08 18:41:00</td>
      <td>2017-08-08 21:00:58</td>
      <td>2017-08-08 22:27:51</td>
      <td>2017-08-08 15:27:51</td>
      <td>0 days 02:14:43</td>
    </tr>
  </tbody>
</table>
<p>67 rows × 12 columns</p>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">unformatted_df</span><span class="p">.</span><span class="n">cp3</span> <span class="o">=</span> <span class="n">unformatted_df</span><span class="p">.</span><span class="n">cp3</span><span class="p">.</span><span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

<span class="n">unformatted_df</span><span class="p">.</span><span class="n">cp3</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">unformatted_df</span><span class="p">.</span><span class="n">cp3</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">unformatted_df</span><span class="p">.</span><span class="n">cp3</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>position
1    2022-09-11 12:58:00
2    2022-09-11 13:20:00
3    2022-09-11 13:50:00
4    2022-09-11 13:52:00
5    2022-09-11 12:33:00
             ...        
63   2022-09-11 14:17:00
64   2022-09-11 14:17:00
65   2022-09-11 14:17:00
66   2022-09-11 14:10:00
67   2022-09-11 14:10:00
Name: cp3, Length: 67, dtype: datetime64[ns]
</code></pre></div></div>

<h2 id="create-class-for-scraping-and-organising-data">
<a class="anchor" href="#create-class-for-scraping-and-organising-data" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create class for scraping and organising data</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Define a class Results for creating Pandas dataframe objects of scrapped data from race results website 
</span>
<span class="k">class</span> <span class="nc">raceResults</span><span class="p">():</span>
    
    <span class="s">"""
    This class returns pandas DataFrame objects which contain data scraped from the race website.
    
    Attributes:
    -----------
    base_url: the url which contains race data in HTML
    year: the year for we would like data
    columns: the column headers for data to be scraped
    check_points: column headers used to calculate time between checkpoints
    """</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_url</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">check_points</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">base_url</span> <span class="o">=</span> <span class="n">base_url</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">year</span> <span class="o">=</span> <span class="n">year</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">columns</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">check_points</span> <span class="o">=</span> <span class="n">check_points</span>
        
    <span class="k">def</span> <span class="nf">basic_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">base_url</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">year</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">).</span><span class="n">text</span>
        <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="s">'lxml'</span><span class="p">)</span>

        <span class="n">lines</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="n">find_all</span><span class="p">(</span><span class="s">'tr'</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
        
        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">line</span><span class="p">.</span><span class="n">find_all</span><span class="p">(</span><span class="s">'td'</span><span class="p">)</span>
            <span class="n">row_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">counter</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="n">row_list</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">counter</span><span class="p">].</span><span class="n">string</span><span class="p">)</span>
            <span class="n">data</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">row_list</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">columns</span><span class="p">).</span><span class="n">set_index</span><span class="p">(</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">df_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">df_results</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">basic_table</span><span class="p">()</span>
    
        <span class="n">total</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df_results</span><span class="p">[</span><span class="s">"total"</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">i</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">total</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">total</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">df_results</span><span class="p">[</span><span class="s">"total"</span><span class="p">]</span> <span class="o">=</span> <span class="n">total</span>

        <span class="k">def</span> <span class="nf">str2_min</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="n">ftr</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3600</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">total_seconds</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">a</span><span class="o">*</span><span class="n">b</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ftr</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="n">x</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">':'</span><span class="p">)))])</span>
                <span class="k">return</span> <span class="nb">round</span><span class="p">((</span><span class="n">total_seconds</span> <span class="o">/</span> <span class="mi">60</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">df_results</span><span class="p">[</span><span class="s">'total_min'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_results</span><span class="p">[</span><span class="s">'total'</span><span class="p">].</span><span class="nb">map</span><span class="p">(</span><span class="n">str2_min</span><span class="p">)</span>
        <span class="n">df_results</span><span class="p">[</span><span class="s">"average_min"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">df_results</span><span class="p">[</span><span class="s">"total_min"</span><span class="p">].</span><span class="n">mean</span><span class="p">(),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">df_results</span><span class="p">[</span><span class="s">"start"</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2017</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span> <span class="p">,</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">cps</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">check_points</span> 

        <span class="k">def</span> <span class="nf">checkpoint2_datetime</span><span class="p">(</span><span class="n">cp</span><span class="p">):</span>
            <span class="n">df_results</span><span class="p">[</span><span class="n">cp</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_results</span><span class="p">[</span><span class="n">cp</span><span class="p">],</span> <span class="nb">format</span> <span class="o">=</span> <span class="s">"%H:%M:%S"</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s">"coerce"</span><span class="p">)</span>
            <span class="n">df_results</span><span class="p">[</span><span class="n">cp</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_results</span><span class="p">[</span><span class="n">cp</span><span class="p">].</span><span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">dt</span><span class="p">:</span> <span class="n">dt</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="n">year</span> <span class="o">=</span> <span class="mi">2017</span><span class="p">,</span> <span class="n">month</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="mi">12</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">df_results</span><span class="p">[</span><span class="n">cp</span><span class="p">]</span>
    
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cps</span><span class="p">:</span> 
            <span class="n">df_results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">checkpoint2_datetime</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            
        <span class="n">df_results</span><span class="p">[</span><span class="s">"time2cp1"</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_results</span><span class="p">[</span><span class="s">"cp1"</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_results</span><span class="p">[</span><span class="s">"start"</span><span class="p">]</span>
        <span class="n">df_results</span><span class="p">[</span><span class="s">"time2cp2"</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_results</span><span class="p">[</span><span class="s">"cp2"</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_results</span><span class="p">[</span><span class="s">"cp1"</span><span class="p">]</span> 
        <span class="n">df_results</span><span class="p">[</span><span class="s">"time2cp3"</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_results</span><span class="p">[</span><span class="s">"cp3"</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_results</span><span class="p">[</span><span class="s">"cp2"</span><span class="p">]</span> 
        <span class="n">df_results</span><span class="p">[</span><span class="s">"time2cp4"</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_results</span><span class="p">[</span><span class="s">"cp4"</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_results</span><span class="p">[</span><span class="s">"cp3"</span><span class="p">]</span> 
        <span class="n">df_results</span><span class="p">[</span><span class="s">"time2cp5"</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_results</span><span class="p">[</span><span class="s">"cp5"</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_results</span><span class="p">[</span><span class="s">"cp4"</span><span class="p">]</span>
        <span class="n">df_results</span><span class="p">[</span><span class="s">"time2cp6"</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_results</span><span class="p">[</span><span class="s">"cp6"</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_results</span><span class="p">[</span><span class="s">"cp5"</span><span class="p">]</span>
        <span class="n">df_results</span><span class="p">[</span><span class="s">"time2end"</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_results</span><span class="p">[</span><span class="s">"finish"</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_results</span><span class="p">[</span><span class="s">"cp6"</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="n">df_results</span>
    
    
    <span class="k">def</span> <span class="nf">top_runners</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
        <span class="n">df_top</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">df_results</span><span class="p">()[:</span><span class="n">x</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">df_top</span>
    
    <span class="k">def</span> <span class="nf">target_runners</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">runner</span><span class="p">):</span>
        <span class="n">df_runner</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">df_results</span><span class="p">().</span><span class="n">loc</span><span class="p">[</span><span class="n">runner</span><span class="p">]</span>
        <span class="n">df_runner</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df_runner</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df_runner</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Next define a standalone function for creating averages from the Results() objects
</span>
<span class="k">def</span> <span class="nf">average_pace</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="n">convert_km</span> <span class="o">=</span> <span class="mf">1.60934</span>
    <span class="n">cp</span> <span class="o">=</span> <span class="p">[</span><span class="s">"time2cp1"</span><span class="p">,</span> <span class="s">"time2cp2"</span><span class="p">,</span> <span class="s">"time2cp3"</span><span class="p">,</span> <span class="s">"time2cp4"</span><span class="p">,</span> <span class="s">"time2cp5"</span><span class="p">,</span> <span class="s">"time2cp6"</span><span class="p">,</span> <span class="s">"time2end"</span><span class="p">]</span>
    <span class="n">cp_miles</span> <span class="o">=</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mf">58.5</span><span class="p">,</span> <span class="mi">63</span><span class="p">]</span>
    <span class="n">cp_miles_s</span> <span class="o">=</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mf">8.5</span><span class="p">,</span><span class="mf">4.5</span><span class="p">]</span>
    <span class="n">cp_distances</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s">"cp_miles"</span><span class="p">:</span> <span class="n">cp_miles</span><span class="p">,</span> <span class="s">"cp_miles_s"</span><span class="p">:</span> <span class="n">cp_miles_s</span><span class="p">},</span> <span class="n">index</span> <span class="o">=</span> <span class="n">cp</span><span class="p">)</span>
    <span class="n">cp_distances</span><span class="p">[</span><span class="s">"cp_km"</span><span class="p">]</span> <span class="o">=</span> <span class="n">cp_distances</span><span class="p">[</span><span class="s">"cp_miles"</span><span class="p">]</span> <span class="o">*</span> <span class="n">convert_km</span>
    <span class="n">cp_distances</span><span class="p">[</span><span class="s">"cp_km_s"</span><span class="p">]</span> <span class="o">=</span> <span class="n">cp_distances</span><span class="p">[</span><span class="s">"cp_miles_s"</span><span class="p">]</span> <span class="o">*</span> <span class="n">convert_km</span>

    <span class="n">df_time2cp</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span> <span class="n">cp</span><span class="p">)</span>
    <span class="n">df_averages</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cp</span><span class="p">:</span> <span class="n">df_averages</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="n">df_time2cp</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)].</span><span class="n">mean</span><span class="p">()</span>

    <span class="n">df_averages</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">Series</span><span class="p">(</span><span class="n">df_averages</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s">"2017"</span><span class="p">)</span>
    <span class="n">df_averages</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df_averages</span><span class="p">)</span>
    <span class="n">df_averages</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_averages</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">cp_distances</span><span class="p">))</span>
    <span class="n">df_averages</span><span class="p">[</span><span class="s">"2017_min"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="p">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">/</span><span class="mi">60</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df_averages</span><span class="p">[</span><span class="s">"2017"</span><span class="p">]]</span>
    <span class="n">df_averages</span><span class="p">[</span><span class="s">"min_km"</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_averages</span><span class="p">[</span><span class="s">"2017_min"</span><span class="p">]</span><span class="o">/</span><span class="n">df_averages</span><span class="p">[</span><span class="s">"cp_km_s"</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">df_averages</span>
</code></pre></div></div>

<h2 id="define-some-variables-we-will-pass-to-our-class">
<a class="anchor" href="#define-some-variables-we-will-pass-to-our-class" aria-hidden="true"><span class="octicon octicon-link"></span></a>Define some variables we will pass to our class</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Race website URL:
</span>
<span class="n">base_url</span> <span class="o">=</span> <span class="sa">r</span><span class="s">'http://www.svp100.co.uk/results-'</span>

<span class="c1"># Column headers for the DataFrame scraped directly from the website:
</span>
<span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s">"pos"</span><span class="p">,</span> <span class="s">"name"</span><span class="p">,</span> <span class="s">"bib"</span><span class="p">,</span> <span class="s">"gender"</span><span class="p">,</span> <span class="s">"start"</span><span class="p">,</span> <span class="s">"club"</span><span class="p">,</span> 
           <span class="s">"cp1"</span><span class="p">,</span> <span class="s">"cp2"</span><span class="p">,</span> <span class="s">"cp3"</span><span class="p">,</span> <span class="s">"cp4"</span><span class="p">,</span> <span class="s">"cp5"</span><span class="p">,</span> <span class="s">"cp6"</span><span class="p">,</span> <span class="s">"finish"</span><span class="p">,</span> <span class="s">"total"</span><span class="p">]</span> 

<span class="c1"># List of new columns we'll add to the DataFrame for our analysis
</span>
<span class="n">check_points</span> <span class="o">=</span> <span class="p">[</span><span class="s">"cp1"</span><span class="p">,</span><span class="s">"cp2"</span><span class="p">,</span><span class="s">"cp3"</span><span class="p">,</span><span class="s">"cp4"</span><span class="p">,</span><span class="s">"cp5"</span><span class="p">,</span><span class="s">"cp6"</span><span class="p">,</span><span class="s">"finish"</span><span class="p">]</span>
</code></pre></div></div>

<h2 id="initialize-a-results-object-with-results-from-2017-race">
<a class="anchor" href="#initialize-a-results-object-with-results-from-2017-race" aria-hidden="true"><span class="octicon octicon-link"></span></a>Initialize a Results() object with results from 2017 race¶</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">results</span> <span class="o">=</span> <span class="n">raceResults</span><span class="p">(</span><span class="n">base_url</span><span class="p">,</span> <span class="mi">2017</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">check_points</span><span class="p">)</span>
<span class="n">all_runners</span> <span class="o">=</span> <span class="n">results</span><span class="p">.</span><span class="n">df_results</span><span class="p">()</span>
<span class="n">all_runners</span> <span class="o">=</span> <span class="n">average_pace</span><span class="p">(</span><span class="n">all_runners</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">top_3</span> <span class="o">=</span> <span class="n">results</span><span class="p">.</span><span class="n">top_runners</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">top_3</span> <span class="o">=</span> <span class="n">average_pace</span><span class="p">(</span><span class="n">top_3</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">me</span> <span class="o">=</span> <span class="n">results</span><span class="p">.</span><span class="n">target_runners</span><span class="p">(</span><span class="s">"Stephen Lemasney"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plots</span> <span class="o">=</span> <span class="n">all_runners</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">top_3</span><span class="p">,</span> <span class="n">lsuffix</span> <span class="o">=</span> <span class="s">"_all"</span><span class="p">,</span> <span class="n">rsuffix</span>  <span class="o">=</span> <span class="s">"_t3"</span><span class="p">)</span>
<span class="n">plots</span> <span class="o">=</span> <span class="n">plots</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">me</span><span class="p">,</span> <span class="n">rsuffix</span><span class="o">=</span><span class="s">"_me"</span> <span class="p">)</span>
<span class="n">plots</span><span class="p">[</span><span class="s">"2017_me"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="p">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">/</span><span class="mi">60</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">plots</span><span class="p">[</span><span class="s">"Stephen Lemasney"</span><span class="p">]]</span>
<span class="n">plots</span><span class="p">[</span><span class="s">"min_km_me"</span><span class="p">]</span> <span class="o">=</span> <span class="n">plots</span><span class="p">[</span><span class="s">"2017_me"</span><span class="p">]</span><span class="o">/</span><span class="n">plots</span><span class="p">[</span><span class="s">"cp_km_s_all"</span><span class="p">]</span>
<span class="n">plots</span> <span class="o">=</span> <span class="n">plots</span><span class="p">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="s">"min_km_all"</span><span class="p">:</span><span class="s">"All Runners"</span><span class="p">,</span><span class="s">"min_km_t3"</span><span class="p">:</span><span class="s">"Top 10"</span><span class="p">,</span><span class="s">"min_km_me"</span><span class="p">:</span><span class="s">"Me"</span><span class="p">})</span>
</code></pre></div></div>

<h2 id="plot-the-results-using-fivethirtyeight-styling">
<a class="anchor" href="#plot-the-results-using-fivethirtyeight-styling" aria-hidden="true"><span class="octicon octicon-link"></span></a>Plot the results using “FiveThirtyEight” styling</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plots</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="s">"All Runners"</span><span class="p">,</span><span class="s">"Top 10"</span><span class="p">,</span><span class="s">"Me"</span><span class="p">],</span> <span class="n">x</span> <span class="o">=</span> <span class="s">"cp_km_all"</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
<span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">'Average pace of runners (minutes per km)'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'Minutes per km'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s">"small"</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'Kilometers'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="images/2018-03-02-svp_29_0.png" alt="png"></p>


  </div><a class="u-url" href="/tutorials/markdown/2018/03/02/svp.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/tutorials/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/tutorials/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/tutorials/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Powered by Fastpages</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/slemasne" target="_blank" title="slemasne"><svg class="svg-icon grey"><use xlink:href="/tutorials/assets/minima-social-icons.svg#github"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
