<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Deploying a Python app with Docker (Part 1) | Stephen Lemasney</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Deploying a Python app with Docker (Part 1)" />
<meta name="author" content="Stephen Lemasney" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Powered by Fastpages" />
<meta property="og:description" content="Powered by Fastpages" />
<link rel="canonical" href="https://slemasne.github.io/tutorials/tutorials/2018/01/03/flask-app-with-docker.html" />
<meta property="og:url" content="https://slemasne.github.io/tutorials/tutorials/2018/01/03/flask-app-with-docker.html" />
<meta property="og:site_name" content="Stephen Lemasney" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-01-03T00:00:00-06:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Deploying a Python app with Docker (Part 1)" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Stephen Lemasney"},"dateModified":"2018-01-03T00:00:00-06:00","datePublished":"2018-01-03T00:00:00-06:00","description":"Powered by Fastpages","headline":"Deploying a Python app with Docker (Part 1)","mainEntityOfPage":{"@type":"WebPage","@id":"https://slemasne.github.io/tutorials/tutorials/2018/01/03/flask-app-with-docker.html"},"url":"https://slemasne.github.io/tutorials/tutorials/2018/01/03/flask-app-with-docker.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/tutorials/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://slemasne.github.io/tutorials/tutorials/feed.xml" title="Stephen Lemasney" /><!-- the google_analytics_id gets auto inserted from the config file -->



<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-57531313-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-57531313-5');
</script>


<link rel="shortcut icon" type="image/x-icon" href="/tutorials/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />

<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/tutorials/">Stephen Lemasney</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/tutorials/about/">About Me</a><a class="page-link" href="/tutorials/">Tutorials</a><a class="page-link" href="/tutorials/search/">Search</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Deploying a Python app with Docker (Part 1)</h1><p class="post-meta post-meta-title"><time class="dt-published" datetime="2018-01-03T00:00:00-06:00" itemprop="datePublished">
        Jan 3, 2018
      </time>• 
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name">Stephen Lemasney</span></span>
       • <span class="read-time" title="Estimated read time">
    
    
      3 min read
    
</span></p>

    

    
      
        <div class="pb-5 d-flex flex-justify-center">
          <div class="px-2">

    <a href="https://github.com/slemasne/tutorials/tree/master/_notebooks/2018-01-03-flask-app-with-docker.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/tutorials/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          
          
          
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#Create-a-Flask-app">Create a Flask app </a></li>
<li class="toc-entry toc-h2"><a href="#Run-a-quick-'hello-world'-type-test">Run a quick &#39;hello world&#39; type test </a></li>
<li class="toc-entry toc-h2"><a href="#Setup-the-Dockerfile">Setup the Dockerfile </a></li>
<li class="toc-entry toc-h2"><a href="#Deconstruct-the-Dockerfile">Deconstruct the Dockerfile </a></li>
<li class="toc-entry toc-h2"><a href="#Run-the-docker-container-locally">Run the docker container locally </a></li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2018-01-03-flask-app-with-docker.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this tutorial, we show how you can build and deploy a really simple Python app using Docker. To demonstrate, we'll create an API to return details of the TFL train lines in London. We'll use <a href="https://flask.palletsprojects.com/en/2.2.x/">Flask</a> to build the application.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Create-a-Flask-app">
<a class="anchor" href="#Create-a-Flask-app" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create a Flask app<a class="anchor-link" href="#Create-a-Flask-app"> </a>
</h2>
<p>First, create a python flask app which returns details about the TFL trains. This application serves a very basic API with details on London's TFL trains.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">jsonify</span><span class="p">,</span> <span class="n">request</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s1">'id'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s1">'service'</span><span class="p">:</span> <span class="s1">'tube'</span><span class="p">,</span>
        <span class="s1">'line'</span><span class="p">:</span> <span class="s1">'northern'</span><span class="p">,</span>
        <span class="s1">'colour'</span><span class="p">:</span> <span class="s1">'black'</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s1">'id'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s1">'service'</span><span class="p">:</span> <span class="s1">'tube'</span><span class="p">,</span>
        <span class="s1">'line'</span><span class="p">:</span> <span class="s1">'circle'</span><span class="p">,</span>
        <span class="s1">'colour'</span><span class="p">:</span> <span class="s1">'red'</span>
    <span class="p">}</span>
<span class="p">]</span>

<span class="k">def</span> <span class="nf">shutdown_server</span><span class="p">():</span>
    <span class="n">func</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'werkzeug.server.shutdown'</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">'Not running with the Werkzeug Server'</span><span class="p">)</span>
    <span class="n">func</span><span class="p">()</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">'/trains'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">'GET'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">get_tasks</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">'tasks'</span><span class="p">:</span> <span class="n">tasks</span><span class="p">})</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello_world</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">'Welcome to trains API'</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">'/exit'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">exit</span><span class="p">():</span>
    <span class="n">message</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Stopping application"</span><span class="p">)</span>
    <span class="n">shutdown_server</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"The Flask server has been shutdown."</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s1">'0.0.0.0'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Run-a-quick-'hello-world'-type-test">
<a class="anchor" href="#Run-a-quick-'hello-world'-type-test" aria-hidden="true"><span class="octicon octicon-link"></span></a>Run a quick 'hello world' type test<a class="anchor-link" href="#Run-a-quick-'hello-world'-type-test"> </a>
</h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">"http://192.168.1.74:5000/"</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">response_code</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span>
<span class="n">response_text</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>

<span class="n">display</span><span class="p">(</span><span class="n">response_code</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">response_text</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea ">
<pre>200</pre>
</div>

</div>

<div class="output_area">



<div class="output_text output_subarea ">
<pre>'Welcome to trains API'</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Setup-the-Dockerfile">
<a class="anchor" href="#Setup-the-Dockerfile" aria-hidden="true"><span class="octicon octicon-link"></span></a>Setup the Dockerfile<a class="anchor-link" href="#Setup-the-Dockerfile"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Next, we want to package the application into a container using a <code>Dockerfile</code>. The finished <code>Dockerfile</code> will look as follows:</p>
<div class="highlight"><pre><span></span><span class="k">FROM</span> <span class="s">python:3.7-alpine</span>

<span class="k">COPY</span> . /app

<span class="k">WORKDIR</span><span class="s"> /app</span>

<span class="k">RUN</span> pip install -r requirements.txt

<span class="k">EXPOSE</span><span class="s"> 5000</span>

<span class="k">CMD</span> <span class="p">[</span><span class="s2">"python"</span><span class="p">,</span> <span class="s2">"app.py"</span><span class="p">]</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Deconstruct-the-Dockerfile">
<a class="anchor" href="#Deconstruct-the-Dockerfile" aria-hidden="true"><span class="octicon octicon-link"></span></a>Deconstruct the Dockerfile<a class="anchor-link" href="#Deconstruct-the-Dockerfile"> </a>
</h2>
<p>Let's break down each line in turn to describe what is happening...</p>
<p>In the first line we declare a <b>parent image</b> which is the image our own image is based on. Each subsequent declaration in the <code>Dockerfile</code> modifies this image. In our example, we use a version of Alpine Linux as our base image. Alpine Linux is a lightweight Linux distribution which makes it ideal for our container.</p>
<div class="highlight"><pre><span></span><span class="k">FROM</span> <span class="s">python:3.7-alpine</span>
</pre></div>
<p>Next we copy all of the files from the current host directory into the container's app directory.</p>
<div class="highlight"><pre><span></span><span class="k">COPY</span> . /app
</pre></div>
<p>We change our working directory to the app directory. And then we tell Docker to install the Python packages needed for the <code>app.py</code></p>
<div class="highlight"><pre><span></span><span class="k">WORKDIR</span><span class="s"> /app</span>

<span class="k">RUN</span> pip install -r requirements.txt
</pre></div>
<p>Next we tell the container to listen on a specific network port at runtime. The default is TCP but you can also specify UDP. Note that the EXPOSE instruction does not actually publish the port. This instruction is there for documentation purposes. To actually publish the port, you need to use the <code>-p</code> flag on the <code>docker run</code> command.</p>
<div class="highlight"><pre><span></span><span class="k">EXPOSE</span><span class="s"> 5000</span>
</pre></div>
<p>Finally, we run the app:</p>
<div class="highlight"><pre><span></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">"python"</span><span class="p">,</span> <span class="s2">"app.py"</span><span class="p">]</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Run-the-docker-container-locally">
<a class="anchor" href="#Run-the-docker-container-locally" aria-hidden="true"><span class="octicon octicon-link"></span></a>Run the docker container locally<a class="anchor-link" href="#Run-the-docker-container-locally"> </a>
</h2>
<p>You might want to run the Dockerfile on your own machine to verify that it is working correctly. To do that, we <code>docker build</code> and then <code>docker run</code>:</p>
<p>You can build the Dockerfile as follows. The <code>-t</code> or <code>tag</code> allows you to tag the image with a name.</p>
<p><code>docker build -t slemasne/trains .</code></p>
<p>Then run the image to create a container which runs our application. The '-p' flag maps port 5000 on localhost in the host to port 5000 in the docker container.</p>
<p><code>docker run -p 5000:5000 slemasne/trains</code></p>
<p>You can also run the command with a '-d' detached flag to run the container in the background:</p>
<p><code>docker run -d -p 5000:5000 slemasne/trains</code></p>
<p>The application can be accessed on our localhost:</p>
<p><code>http://localhost:5000/trains</code></p>

</div>
</div>
</div>
</div>



  </div><a class="u-url" href="/tutorials/2018/01/03/flask-app-with-docker.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/tutorials/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/tutorials/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/tutorials/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Powered by Fastpages</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/slemasne" target="_blank" title="slemasne"><svg class="svg-icon grey"><use xlink:href="/tutorials/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/StephenLeMasney" target="_blank" title="StephenLeMasney"><svg class="svg-icon grey"><use xlink:href="/tutorials/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
